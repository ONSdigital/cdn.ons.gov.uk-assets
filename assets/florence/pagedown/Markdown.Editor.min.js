!function(){var e={},t={},n={},i=window.document,r=window.RegExp,o=window.navigator,a=72,s={isIE:/msie/.test(o.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(o.userAgent.toLowerCase())||/msie 5/.test(o.userAgent.toLowerCase()),isOpera:/opera/.test(o.userAgent.toLowerCase())},l={bold:"Strong <strong> Ctrl+B",boldexample:"strong text",italic:"Emphasis <em> Ctrl+I",italicexample:"emphasized text",link:"Hyperlink <a> Ctrl+L",linkdescription:"enter link description here",linkdialog:'<p><b>Insert Hyperlink</b></p><p>http://example.com/ "optional title"</p>',quote:"Blockquote <blockquote> Ctrl+Q",quoteexample:"Blockquote",code:"Code Sample <pre><code> Ctrl+K",codeexample:"enter code here",image:"Image <img> Ctrl+G",imagedescription:"enter image description here",imagedialog:"<p><b>Insert Image</b></p><p>http://example.com/images/diagram.jpg</p>",olist:"Numbered List <ol> Ctrl+O",ulist:"Bulleted List <ul> Ctrl+U",litem:"List item",heading:"Heading <h1>/<h2> Ctrl+H",headingexample:"Heading",superscript:"Superscript <sup> Ctrl+m",superscriptexample:"superscript",subscript:"Subscript <sub> Ctrl+q",subscriptexample:"subscript",hr:"Horizontal Rule <hr> Ctrl+R",undo:"Undo - Ctrl+Z",redo:"Redo - Ctrl+Y",redomac:"Redo - Ctrl+Shift+Z",help:"Markdown Editing Help"};function c(){$("#wmd-input").trigger("input")}function d(){}function u(e){this.buttonBar=i.getElementById("wmd-button-bar"+e),this.preview=i.getElementById("wmd-preview"+e),this.input=i.getElementById("wmd-input"+e)}function p(t,n){var i,r,o,a=this,l=[],d=0,u="none",p=function(e,t){u!=e&&(u=e,t||g()),s.isIE&&"moving"==u?o=null:r=setTimeout(h,1)},h=function(e){o=new f(n,e),r=void 0};this.setCommandMode=function(){u="command",g(),r=setTimeout(h,0)},this.canUndo=function(){return d>1},this.canRedo=function(){return!!l[d+1]},this.undo=function(){a.canUndo()&&(i?(i.restore(),i=null):(l[d]=new f(n),l[--d].restore(),t&&t())),u="none",n.input.focus(),h(),c()},this.redo=function(){a.canRedo()&&(l[++d].restore(),t&&t()),u="none",n.input.focus(),h(),c()};var g=function(){var e=o||new f(n);if(!e)return!1;"moving"!=u?(i&&(l[d-1].text!=i.text&&(l[d++]=i),i=null),l[d++]=e,l[d+1]=null,t&&t()):i||(i=e)},m=function(e){var t=!1;if((e.ctrlKey||e.metaKey)&&!e.altKey){var n=e.charCode||e.keyCode;switch(String.fromCharCode(n).toLowerCase()){case"y":a.redo(),t=!0;break;case"z":e.shiftKey?a.redo():a.undo(),t=!0}}if(t)return e.preventDefault&&e.preventDefault(),void(window.event&&(window.event.returnValue=!1))},v=function(e){if(!e.ctrlKey&&!e.metaKey){var t=e.keyCode;t>=33&&t<=40||t>=63232&&t<=63235?p("moving"):8==t||46==t||127==t?p("deleting"):13==t?p("newlines"):27==t?p("escape"):(t<16||t>20)&&91!=t&&p("typing")}};!function(){e.addEvent(n.input,"keypress",function(e){!e.ctrlKey&&!e.metaKey||e.altKey||89!=e.keyCode&&90!=e.keyCode||e.preventDefault()});var t=function(){(s.isIE||o&&o.text!=n.input.value)&&null==r&&(u="paste",g(),h())};e.addEvent(n.input,"keydown",m),e.addEvent(n.input,"keydown",v),e.addEvent(n.input,"mousedown",function(){p("moving")}),n.input.onpaste=t,n.input.ondrop=t}(),h(!0),g()}function f(t,n){var r=this,o=t.input;this.init=function(){e.isVisible(o)&&(!n&&i.activeElement&&i.activeElement!==o||(this.setInputAreaSelectionStartEnd(),this.scrollTop=o.scrollTop,(!this.text&&o.selectionStart||0===o.selectionStart)&&(this.text=o.value)))},this.setInputAreaSelection=function(){if(e.isVisible(o))if(void 0===o.selectionStart||s.isOpera){if(i.selection){if(i.activeElement&&i.activeElement!==o)return;o.focus();var t=o.createTextRange();t.moveStart("character",-o.value.length),t.moveEnd("character",-o.value.length),t.moveEnd("character",r.end),t.moveStart("character",r.start),t.select()}}else o.focus(),o.selectionStart=r.start,o.selectionEnd=r.end,o.scrollTop=r.scrollTop},this.setInputAreaSelectionStartEnd=function(){if(t.ieCachedRange||!o.selectionStart&&0!==o.selectionStart){if(i.selection){r.text=e.fixEolChars(o.value);var n=t.ieCachedRange||i.selection.createRange(),a=e.fixEolChars(n.text),s=""+a+"";n.text=s;var l=e.fixEolChars(o.value);n.moveStart("character",-s.length),n.text=a,r.start=l.indexOf(""),r.end=l.lastIndexOf("")-"".length;var c=r.text.length-e.fixEolChars(o.value).length;if(c){for(n.moveStart("character",-a.length);c--;)a+="\n",r.end+=1;n.text=a}t.ieCachedRange&&(r.scrollTop=t.ieCachedScrollTop),t.ieCachedRange=null,this.setInputAreaSelection()}}else r.start=o.selectionStart,r.end=o.selectionEnd},this.restore=function(){null!=r.text&&r.text!=o.value&&(o.value=r.text),this.setInputAreaSelection(),o.scrollTop=r.scrollTop},this.getChunks=function(){var t=new d;return t.before=e.fixEolChars(r.text.substring(0,r.start)),t.startTag="",t.selection=e.fixEolChars(r.text.substring(r.start,r.end)),t.endTag="",t.after=e.fixEolChars(r.text.substring(r.end)),t.scrollTop=r.scrollTop,t},this.setChunks=function(e){e.before=e.before+e.startTag,e.after=e.endTag+e.after,this.start=e.before.length,this.end=e.before.length+e.selection.length,this.text=e.before+e.selection+e.after,this.scrollTop=e.scrollTop},this.init()}function h(n,r,o){var a,l,c,d=function(){var e=0;return window.innerHeight?e=window.pageYOffset:i.documentElement&&i.documentElement.scrollTop?e=i.documentElement.scrollTop:i.body&&(e=i.body.scrollTop),e},u=function(){if(r.preview){var e=r.input.value;if(!e||e!=c){c=e;var t=(new Date).getTime();e=n.makeHtml(e);var i=(new Date).getTime();l=i-t,w(e)}}},p=function(){a&&(clearTimeout(a),a=void 0);var e=0;(e=l)>3e3&&(e=3e3),a=setTimeout(u,e)};this.refresh=function(e){e?(c="",u()):p()},this.processingTime=function(){return l};var f,h,g,m=!0,v=function(e){var t=r.preview,n=t.parentNode,i=t.nextSibling;n.removeChild(t),t.innerHTML=e,i?n.insertBefore(t,i):n.appendChild(t)},b=function(e){r.preview.innerHTML=e},w=function(e){var n,i=t.getTop(r.input)-d();if(r.preview&&(!function(e){if(f)return f(e);try{b(e),f=b}catch(t){(f=v)(e)}}(e),o()),r.preview&&(r.preview.scrollTop=(r.preview.scrollHeight-r.preview.clientHeight)*((n=r.preview).scrollHeight<=n.clientHeight?1:n.scrollTop/(n.scrollHeight-n.clientHeight))),m)m=!1;else{var a=t.getTop(r.input)-d();s.isIE?setTimeout(function(){window.scrollBy(0,a-i)},0):window.scrollBy(0,a-i)}};h=r.input,g=p,e.addEvent(h,"input",g),h.onpaste=g,h.ondrop=g,e.addEvent(h,"keypress",g),e.addEvent(h,"keydown",g),u(),r.preview&&(r.preview.scrollTop=0)}function g(t,n,r,a,l,c,d){var u=n.input,p={};!function(){var e=n.buttonBar,i=document.createElement("ul");i.id="wmd-button-row"+t,i.className="markdown-editor__options",i=e.appendChild(i);var r=0,a=function(e,n,o,a){var s=document.createElement("li");s.className="markdown-editor__button",s.style.left=r+"px",r+=25;var l=document.createElement("span");return s.id=e+t,s.appendChild(l),s.title=n,s.XShift=o,a&&(s.textOp=a),m(s,!0),i.appendChild(s),s};p.bold=a("wmd-bold-button",d("bold"),"0px",v("doBold")),p.italic=a("wmd-italic-button",d("italic"),"-20px",v("doItalic")),p.link=a("wmd-link-button",d("link"),"-40px",v(function(e,t){return this.doLinkOrImage(e,t,!1)})),p.quote=a("wmd-quote-button",d("quote"),"-60px",v("doBlockquote")),p.code=a("wmd-code-button",d("code"),"-80px",v("doCode")),p.image=a("wmd-image-button",d("image"),"-100px",v(function(e,t){return this.doLinkOrImage(e,t,!0)})),p.olist=a("wmd-olist-button",d("olist"),"-120px",v(function(e,t){this.doList(e,t,!0)})),p.ulist=a("wmd-ulist-button",d("ulist"),"-140px",v(function(e,t){this.doList(e,t,!1)})),p.heading=a("wmd-heading-button",d("heading"),"-160px",v("doHeading")),p.superscript=a("wmd-superscript-button",d("superscript"),"-165px",v("doSuperscript")),p.subscript=a("wmd-subscript-button",d("subscript"),"-175px",v("doSubscript")),p.hr=a("wmd-hr-button",d("hr"),"-180px",v("doHorizontalRule")),p.undo=a("wmd-undo-button",d("undo"),"-200px",null),p.undo.execute=function(e){e&&e.undo()};var s=/win/.test(o.platform.toLowerCase())?d("redo"):d("redomac");if(p.redo=a("wmd-redo-button",s,"-220px",null),p.redo.execute=function(e){e&&e.redo()},c){var l=document.createElement("li"),u=document.createElement("span");l.appendChild(u),l.className="wmd-button wmd-help-button",l.id="wmd-help-button"+t,l.XShift="-240px",l.isHelp=!0,l.style.right="0px",l.title=d("help"),l.onclick=c.handler,m(l,!0),i.appendChild(l),p.help=l}b()}();var h="keydown";function g(e){if(u.focus(),e.textOp){r&&r.setCommandMode();var t=new f(n);if(!t)return;var i=t.getChunks(),o=function(){u.focus(),i&&t.setChunks(i),t.restore(),a.refresh()};e.textOp(i,o)||o()}e.execute&&e.execute(r)}function m(e,t){var r=e.getElementsByTagName("span")[0];t?(r.style.backgroundPosition=e.XShift+" 0px",e.onmouseover=function(){r.style.backgroundPosition=this.XShift+" -40px"},e.onmouseout=function(){r.style.backgroundPosition=this.XShift+" 0px"},s.isIE&&(e.onmousedown=function(){i.activeElement&&i.activeElement!==n.input||(n.ieCachedRange=document.selection.createRange(),n.ieCachedScrollTop=n.input.scrollTop)}),e.isHelp||(e.onclick=function(){return this.onmouseout&&this.onmouseout(),g(this),!1})):(r.style.backgroundPosition=e.XShift+" -20px",e.onmouseover=e.onmouseout=e.onclick=function(){})}function v(e){return"string"==typeof e&&(e=l[e]),function(){e.apply(l,arguments)}}function b(){r&&(m(p.undo,r.canUndo()),m(p.redo,r.canRedo()))}s.isOpera&&(h="keypress"),e.addEvent(u,h,function(e){if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey){var t=e.charCode||e.keyCode;switch(String.fromCharCode(t).toLowerCase()){case"b":g(p.bold);break;case"i":g(p.italic);break;case"l":g(p.link);break;case"6":g(p.quote);break;case"k":g(p.code);break;case"g":g(p.image);break;case"o":g(p.olist);break;case"u":g(p.ulist);break;case"q":g(p.subscript);break;case"m":g(p.superscript);break;case"h":g(p.heading);break;case"r":g(p.hr);break;case"y":g(p.redo);break;case"z":e.shiftKey?g(p.redo):g(p.undo);break;default:return}e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1)}}),e.addEvent(u,"keyup",function(e){if(e.shiftKey&&!e.ctrlKey&&!e.metaKey&&13===(e.charCode||e.keyCode)){var t={};t.textOp=v("doAutoindent"),g(t)}}),s.isIE&&e.addEvent(u,"keydown",function(e){if(27===e.keyCode)return!1}),this.setUndoRedoButtonStates=b}function m(e,t){this.hooks=e,this.getString=t}Markdown.Editor=function(e,t,n){"function"==typeof(n=n||{}).handler&&(n={helpButton:n}),n.strings=n.strings||{},n.helpButton&&(n.strings.help=n.strings.help||n.helpButton.title);var r=function(e){return n.strings[e]||l[e]};t=t||"";var o=this.hooks=new Markdown.HookCollection;o.addNoop("onPreviewRefresh"),o.addNoop("postBlockquoteCreation"),o.addFalse("insertImageDialog"),this.getConverter=function(){return e};var a,s=this;this.run=function(){if(!a){a=new u(t);var l,c,d=new m(o,r),f=new h(e,a,function(){o.onPreviewRefresh()});/\?noundo/.test(i.location.href)||(l=new p(function(){f.refresh(),c&&c.setUndoRedoButtonStates()},a),this.textOperation=function(e){l.setCommandMode(),e(),s.refreshPreview()}),(c=new g(t,a,l,f,d,n.helpButton,r)).setUndoRedoButtonStates(),(s.refreshPreview=function(){f.refresh(!0)})()}}},d.prototype.findTags=function(t,n){var i,r=this;t&&(i=e.extendRegExp(t,"","$"),this.before=this.before.replace(i,function(e){return r.startTag=r.startTag+e,""}),i=e.extendRegExp(t,"^",""),this.selection=this.selection.replace(i,function(e){return r.startTag=r.startTag+e,""})),n&&(i=e.extendRegExp(n,"","$"),this.selection=this.selection.replace(i,function(e){return r.endTag=e+r.endTag,""}),i=e.extendRegExp(n,"^",""),this.after=this.after.replace(i,function(e){return r.endTag=e+r.endTag,""}))},d.prototype.trimWhitespace=function(e){var t,n,i=this;e?t=n="":(t=function(e){return i.before+=e,""},n=function(e){return i.after=e+i.after,""}),this.selection=this.selection.replace(/^(\s*)/,t).replace(/(\s*)$/,n)},d.prototype.skipLines=function(e,t,n){var i,o;if(void 0===e&&(e=1),void 0===t&&(t=1),e++,t++,navigator.userAgent.match(/Chrome/)&&"X".match(/()./),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+r.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+r.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+r.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+r.$1,this.before){for(i=o="";e--;)i+="\\n?",o+="\n";n&&(i="\\n*"),this.before=this.before.replace(new r(i+"$",""),o)}if(this.after){for(i=o="";t--;)i+="\\n?",o+="\n";n&&(i="\\n*"),this.after=this.after.replace(new r(i,""),o)}},e.isVisible=function(e){return window.getComputedStyle?"none"!==window.getComputedStyle(e,null).getPropertyValue("display"):e.currentStyle?"none"!==e.currentStyle.display:void 0},e.addEvent=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},e.removeEvent=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},e.fixEolChars=function(e){return e=(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")},e.extendRegExp=function(e,t,n){null==t&&(t=""),null==n&&(n="");var i,o=e.toString();return o=(o=o.replace(/\/([gim]*)$/,function(e,t){return i=t,""})).replace(/(^\/|\/$)/g,""),new r(o=t+o+n,i)},t.getTop=function(e,t){var n=e.offsetTop;if(!t)for(;e=e.offsetParent;)n+=e.offsetTop;return n},t.getHeight=function(e){return e.offsetHeight||e.scrollHeight},t.getWidth=function(e){return e.offsetWidth||e.scrollWidth},t.getPageSize=function(){var e,t,n,r;return self.innerHeight&&self.scrollMaxY?(e=i.body.scrollWidth,t=self.innerHeight+self.scrollMaxY):i.body.scrollHeight>i.body.offsetHeight?(e=i.body.scrollWidth,t=i.body.scrollHeight):(e=i.body.offsetWidth,t=i.body.offsetHeight),self.innerHeight?(n=self.innerWidth,r=self.innerHeight):i.documentElement&&i.documentElement.clientHeight?(n=i.documentElement.clientWidth,r=i.documentElement.clientHeight):i.body&&(n=i.body.clientWidth,r=i.body.clientHeight),[Math.max(e,n),Math.max(t,r),n,r]},n.createBackground=function(){var e=i.createElement("div"),n=e.style;e.className="wmd-prompt-background",n.position="absolute",n.top="0",n.zIndex="1000",s.isIE?n.filter="alpha(opacity=50)":n.opacity="0.5";var r=t.getPageSize();return n.height=r[1]+"px",s.isIE?(n.left=i.documentElement.scrollLeft,n.width=i.documentElement.clientWidth):(n.left="0",n.width="100%"),i.body.appendChild(e),e},n.prompt=function(n,r,o){var a,l,c,d;void 0===r&&(r="");var u=function(e){if(27===(e.charCode||e.keyCode))return e.stopPropagation&&e.stopPropagation(),p(!0),!1},p=function(t){e.removeEvent(i.body,"keyup",u);var n=l.value;return t?n=null:(n=n.replace(/^http:\/\/(https?|ftp):\/\//,"$1://"),/^(?:https?|ftp):\/\//.test(n)||(n="http://"+n),1==c.checked&&(n=n.replace(/^.*\/\/[^\/]*/,""))),a.parentNode.removeChild(a),o(n),!1};setTimeout(function(){!function(){(a=i.createElement("div")).className="wmd-prompt-dialog",a.style.padding="10px;",a.style.position="fixed",a.style.width="400px",a.style.zIndex="1001";var o=i.createElement("div");o.innerHTML=n,o.style.padding="5px",a.appendChild(o);var f=i.createElement("form"),h=f.style;f.onsubmit=function(){return p(!1)},h.padding="0",h.margin="0",h.cssFloat="left",h.width="100%",h.position="relative",a.appendChild(f),(c=i.createElement("input")).id="internal",c.type="checkbox",(h=c.style).float="left",h.margin="0px",h.marginLeft="45px",f.appendChild(c),(d=document.createElement("label")).innerHTML="Internal",d.htmlFor="internal",(h=d.style).marginLeft="20px",f.appendChild(d),(l=i.createElement("input")).type="text",l.value=r,(h=l.style).display="block",h.width="80%",h.marginLeft=h.marginRight="auto",f.appendChild(l);var g=i.createElement("input");g.type="button",g.onclick=function(){return p(!1)},g.value="OK",(h=g.style).margin="10px",h.display="inline",h.width="7em",h.border="1px solid #888888",h.fontFamily="trebuchet MS, helvetica, sans-serif",h.fontSize="0.8em",h.fontWeight="bold";var m=i.createElement("input");m.type="button",m.onclick=function(){return p(!0)},m.value="Cancel",(h=m.style).margin="10px",h.display="inline",h.width="7em",h.border="1px solid #888888",h.fontFamily="trebuchet MS, helvetica, sans-serif",h.fontSize="0.8em",h.fontWeight="bold";let v=i.createElement("div");(h=v.style).textAlign="center",v.appendChild(g),v.appendChild(m),f.appendChild(v),e.addEvent(i.body,"keyup",u),a.style.top="50%",a.style.left="50%",a.style.display="block",s.isIE_5or6&&(a.style.position="absolute",a.style.top=i.documentElement.scrollTop+200+"px",a.style.left="50%"),i.body.appendChild(a),a.style.marginTop=-t.getHeight(a)/2+"px",a.style.marginLeft=-t.getWidth(a)/2+"px"}();var o=r.length;if(void 0!==l.selectionStart)l.selectionStart=0,l.selectionEnd=o;else if(l.createTextRange){var f=l.createTextRange();f.collapse(!1),f.moveStart("character",-o),f.moveEnd("character",o),f.select()}l.focus()},0)};var v=m.prototype;v.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",v.unwrap=function(e){var t=new r("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");e.selection=e.selection.replace(t,"$1 $2")},v.wrap=function(e,t){this.unwrap(e);var n=new r("(.{1,"+t+"})( +|$\\n?)","gm"),i=this;e.selection=e.selection.replace(n,function(e,t){return new r("^"+i.prefixes,"").test(e)?e:t+"\n"}),e.selection=e.selection.replace(/\s+$/,"")},v.doBold=function(e,t){return this.doBorI(e,t,2,this.getString("boldexample"))},v.doItalic=function(e,t){return this.doBorI(e,t,1,this.getString("italicexample"))},v.doBorI=function(e,t,n,i){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n");var o=/(\**$)/.exec(e.before)[0],a=/(^\**)/.exec(e.after)[0],s=Math.min(o.length,a.length);if(s>=n&&(2!=s||1!=n))e.before=e.before.replace(r("[*]{"+n+"}$",""),""),e.after=e.after.replace(r("^[*]{"+n+"}",""),"");else if(!e.selection&&a){e.after=e.after.replace(/^([*_]*)/,""),e.before=e.before.replace(/(\s?)$/,"");var l=r.$1;e.before=e.before+a+l}else{e.selection||a||(e.selection=i);var c=n<=1?"*":"**";e.before=e.before+c,e.after=c+e.after}},v.stripLinkDefs=function(e,t){return e=e.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(e,n,i,r,o){return t[n]=e.replace(/\s*$/,""),r?(t[n]=e.replace(/["(](.+?)[")]$/,""),r+o):""})},v.addLinkDef=function(e,t){var n=0,i={};e.before=this.stripLinkDefs(e.before,i),e.selection=this.stripLinkDefs(e.selection,i),e.after=this.stripLinkDefs(e.after,i);var r="",o=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,a=function(e){n++,e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+n+"]:"),r+="\n"+e},s=function(e,t,r,l,c,d){return r=r.replace(o,s),i[c]?(a(i[c]),t+r+l+n+d):e};e.before=e.before.replace(o,s),t?a(t):e.selection=e.selection.replace(o,s);var l=n;return e.after=e.after.replace(o,s),e.after&&(e.after=e.after.replace(/\n*$/,"")),e.after||(e.selection=e.selection.replace(/\n*$/,"")),e.after+="\n\n"+r,l},v.doLinkOrImage=function(e,t,i){var r;if(e.trimWhitespace(),e.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/),!(e.endTag.length>1&&e.startTag.length>0)){if(e.selection=e.startTag+e.selection+e.endTag,e.startTag=e.endTag="",/\n\n/.test(e.selection))return void this.addLinkDef(e,null);var o=this,a=function(n){if(r.parentNode.removeChild(r),null!==n){e.selection=(" "+e.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var a=" [999]: "+n.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(e,t,n){var i=!1;return t=t.replace(/%(?:[\da-fA-F]{2})|\?|\+|[^\w\d-./[\]]/g,function(e){if(3===e.length&&"%"==e.charAt(0))return e.toUpperCase();switch(e){case"?":return i=!0,"?";case"+":if(i)return"%20"}return encodeURI(e)}),n&&(n=(n=n.trim?n.trim():n.replace(/^\s*/,"").replace(/\s*$/,"")).replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),n?t+' "'+n+'"':t}),s=o.addLinkDef(e,a);e.startTag=i?"![":"[",e.endTag="]["+s+"]",e.selection||(e.selection=i?o.getString("imagedescription"):o.getString("linkdescription"))}t(),c()};return r=n.createBackground(),i?this.hooks.insertImageDialog(a)||n.prompt(this.getString("imagedialog"),"http://",a):n.prompt(this.getString("linkdialog"),"http://",a),!0}e.startTag=e.startTag.replace(/!?\[/,""),e.endTag="",this.addLinkDef(e,null)},v.doAutoindent=function(e,t){var n=!1;e.before=e.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),e.selection||/^[ \t]*(?:\n|$)/.test(e.after)||(e.after=e.after.replace(/^[^\n]*/,function(t){return e.selection=t,""}),n=!0),/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(e.before)&&this.doList&&this.doList(e),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(e.before)&&this.doBlockquote&&this.doBlockquote(e),/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&this.doCode&&this.doCode(e),n&&(e.after=e.selection+e.after,e.selection="")},v.doBlockquote=function(e,t){e.selection=e.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(t,n,i,r){return e.before+=n,e.after=r+e.after,i}),e.before=e.before.replace(/(>[ \t]*)$/,function(t,n){return e.selection=n+e.selection,""}),e.selection=e.selection.replace(/^(\s|>)+$/,""),e.selection=e.selection||this.getString("quoteexample");var n,i="",r="";if(e.before){for(var o=e.before.replace(/\n$/,"").split("\n"),s=!1,l=0;l<o.length;l++){var c=!1;n=o[l],s=s&&n.length>0,/^>/.test(n)?(c=!0,!s&&n.length>1&&(s=!0)):c=!!/^[ \t]*$/.test(n)||s,c?i+=n+"\n":(r+=i+n,i="\n")}/(^|\n)>/.test(i)||(r+=i,i="")}e.startTag=i,e.before=r,e.after&&(e.after=e.after.replace(/^\n?/,"\n")),e.after=e.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(t){return e.endTag=t,""});var d=function(t){var n=t?"> ":"";e.startTag&&(e.startTag=e.startTag.replace(/\n((>|\s)*)\n$/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})),e.endTag&&(e.endTag=e.endTag.replace(/^\n((>|\s)*)\n/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"}))};/^(?![ ]{0,3}>)/m.test(e.selection)?(this.wrap(e,a-2),e.selection=e.selection.replace(/^/gm,"> "),d(!0),e.skipLines()):(e.selection=e.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(e),d(!1),!/^(\n|^)[ ]{0,3}>/.test(e.selection)&&e.startTag&&(e.startTag=e.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(e.selection)&&e.endTag&&(e.endTag=e.endTag.replace(/^\n{0,2}/,"\n\n"))),e.selection=this.hooks.postBlockquoteCreation(e.selection),/\n/.test(e.selection)||(e.selection=e.selection.replace(/^(> *)/,function(t,n){return e.startTag+=n,""}))},v.doCode=function(e,t){var n=/\S[ ]*$/.test(e.before);if(!/^[ ]*\S/.test(e.after)&&!n||/\n/.test(e.selection)){e.before=e.before.replace(/[ ]{4}$/,function(t){return e.selection=t+e.selection,""});var i=1,r=1;/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&(i=0),/^\n(\t|[ ]{4,})/.test(e.after)&&(r=0),e.skipLines(i,r),e.selection?/^[ ]{0,3}\S/m.test(e.selection)?/\n/.test(e.selection)?e.selection=e.selection.replace(/^/gm,"    "):e.before+="    ":e.selection=e.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\t)/gm,""):(e.startTag="    ",e.selection=this.getString("codeexample"))}else e.trimWhitespace(),e.findTags(/`/,/`/),e.startTag||e.endTag?e.endTag&&!e.startTag?(e.before+=e.endTag,e.endTag=""):e.startTag=e.endTag="":(e.startTag=e.endTag="`",e.selection||(e.selection=this.getString("codeexample")))},v.doList=function(e,t,n){var i=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,o="-",s=1,l=function(){var e;return n?(e=" "+s+". ",s++):e=" "+o+" ",e},c=function(e){return void 0===n&&(n=/^\s*\d/.test(e)),e=e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(e){return l()})};if(e.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!e.before||/\n$/.test(e.before)||/^\n/.test(e.startTag)||(e.before+=e.startTag,e.startTag=""),e.startTag){var d=/\d+[.]/.test(e.startTag);if(e.startTag="",e.selection=e.selection.replace(/\n[ ]{4}/g,"\n"),this.unwrap(e),e.skipLines(),d&&(e.after=e.after.replace(i,c)),n==d)return}var u=1;e.before=e.before.replace(/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,function(e){return/^\s*([*+-])/.test(e)&&(o=r.$1),u=/[^\n]\n\n[^\n]/.test(e)?1:0,c(e)}),e.selection||(e.selection=this.getString("litem"));var p=l(),f=1;e.after=e.after.replace(i,function(e){return f=/[^\n]\n\n[^\n]/.test(e)?1:0,c(e)}),e.trimWhitespace(!0),e.skipLines(u,f,!0),e.startTag=p;var h=p.replace(/./g," ");this.wrap(e,a-h.length),e.selection=e.selection.replace(/\n/g,"\n"+h)},v.doHeading=function(e,t){if(e.selection=e.selection.replace(/\s+/g," "),e.selection=e.selection.replace(/(^\s+|\s+$)/g,""),!e.selection)return e.startTag="## ",e.selection=this.getString("headingexample"),void(e.endTag=" ##");var n=0;e.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(e.startTag)&&(n=r.lastMatch.length),e.startTag=e.endTag="",e.findTags(null,/\s?(-+|=+)/),/=+/.test(e.endTag)&&(n=1),/-+/.test(e.endTag)&&(n=2),e.startTag=e.endTag="",e.skipLines(1,1);var i=0==n?2:n-1;if(i>0){var o=i>=2?"-":"=",s=e.selection.length;for(s>a&&(s=a),e.endTag="\n";s--;)e.endTag+=o}},v.doSuperscript=function(e,t){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n");var n=/(\^*$)/.exec(e.before)[0],i=/(^\^*)/.exec(e.after)[0];if(Math.min(n.length,i.length)>=1)e.before=e.before.replace(r("[^]{1}$",""),""),e.after=e.after.replace(r("^[^]{1}",""),"");else{e.selection||i||(e.selection=this.getString("superscriptexample"));e.before=e.before+"^",e.after="^"+e.after}},v.doSubscript=function(e,t){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n");var n=/(~*$)/.exec(e.before)[0],i=/(^~*)/.exec(e.after)[0];if(Math.min(n.length,i.length)>=1)e.before=e.before.replace(r("[~]{1}$",""),""),e.after=e.after.replace(r("^[~]{1}",""),"");else{e.selection||i||(e.selection=this.getString("subscriptexample"));e.before=e.before+"~",e.after="~"+e.after}},v.doHorizontalRule=function(e,t){e.startTag="----------\n",e.selection="",e.skipLines(2,1,!0)}}();